<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }

        /* --- Menu Styles --- */
        #menu, #difficultyMenu {
            text-align: center;
        }
        .menu-button, .difficulty-button {
            font-size: 20px;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            border-radius: 8px;
            border: 2px solid #2c3e50;
            background-color: white;
            color: #2c3e50;
            transition: background-color 0.3s, color 0.3s;
            display: block;
            width: 250px;
        }
        .menu-button:hover, .difficulty-button:hover {
            background-color: #2c3e50;
            color: white;
        }
        .difficulty-button {
            font-size: 18px;
            border-color: #7f8c8d;
        }
        .difficulty-button:hover {
            background-color: #7f8c8d;
        }
        .back-button {
            background-color: #c0392b;
            color: white;
            border-color: #c0392b;
            margin-top: 20px;
        }
        .back-button:hover {
            background-color: #e74c3c;
        }

        /* --- Game Styles --- */
        #gameContainer {
            text-align: center;
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            border: 3px solid #000;
            width: 300px;
            height: 300px;
            background-color: #fff;
            margin: 0 auto;
        }

        .cell {
            width: 100px;
            height: 100px;
            border: 1px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            font-weight: bold;
            cursor: pointer;
            box-sizing: border-box;
        }

        .cell:nth-child(3n) { border-right: none; }
        .cell:nth-child(3n + 1) { border-left: none; }
        .cell:nth-child(n):nth-child(-n + 3) { border-top: none; }
        .cell:nth-child(n):nth-child(n + 7) { border-bottom: none; }

        #gameBoard .cell[data-cell-index="1"],
        #gameBoard .cell[data-cell-index="4"],
        #gameBoard .cell[data-cell-index="7"] {
            border-left: 3px solid #000;
            border-right: 3px solid #000;
        }

        #gameBoard .cell[data-cell-index="3"],
        #gameBoard .cell[data-cell-index="4"],
        #gameBoard .cell[data-cell-index="5"] {
            border-top: 3px solid #000;
            border-bottom: 3px solid #000;
        }

        .cell.X { color: #e74c3c; }
        .cell.O { color: #3498db; }

        #gameStatus {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #2980b9;
        }

        .game-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #restartButton {
            background-color: #27ae60;
            color: white;
        }
        #restartButton:hover { background-color: #2ecc71; }
        
        #backToMenuButton {
            background-color: #f39c12;
            color: white;
            margin-left: 10px;
        }
        #backToMenuButton:hover { background-color: #f1c40f; }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    
    <div id="mainMenu">
        <h1>Tic-Tac-Toe</h1>
        <button id="playFriendButton" class="menu-button">Play with Friend</button>
        <button id="playComputerButton" class="menu-button">Play with Computer</button>
    </div>
    
    <div id="difficultyMenu" class="hidden">
        <h2>Select Difficulty</h2>
        <button class="difficulty-button" data-difficulty="easy">Easy</button>
        <button class="difficulty-button" data-difficulty="medium">Medium</button>
        <button class="difficulty-button" data-difficulty="hard">Hard</button>
        <button id="backToMainButton" class="menu-button back-button">Back</button>
    </div>

    <div id="gameContainer" class="hidden">
        <h1>Tic-Tac-Toe</h1>
        <div id="gameBoard">
            <div class="cell" data-cell-index="0"></div>
            <div class="cell" data-cell-index="1"></div>
            <div class="cell" data-cell-index="2"></div>
            <div class="cell" data-cell-index="3"></div>
            <div class="cell" data-cell-index="4"></div>
            <div class="cell" data-cell-index="5"></div>
            <div class="cell" data-cell-index="6"></div>
            <div class="cell" data-cell-index="7"></div>
            <div class="cell" data-cell-index="8"></div>
        </div>
        <div id="gameStatus"></div>
        <div>
            <button id="restartButton" class="game-button">Restart Game</button>
            <button id="backToMenuButton" class="game-button">Back to Menu</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const mainMenu = document.getElementById('mainMenu');
        const difficultyMenu = document.getElementById('difficultyMenu');
        const gameContainer = document.getElementById('gameContainer');

        const playFriendButton = document.getElementById('playFriendButton');
        const playComputerButton = document.getElementById('playComputerButton');
        const difficultyButtons = document.querySelectorAll('.difficulty-button');
        const backToMainButton = document.getElementById('backToMainButton');
        const backToMenuButton = document.getElementById('backToMenuButton');
        
        const cells = document.querySelectorAll('.cell');
        const gameStatus = document.getElementById('gameStatus');
        const restartButton = document.getElementById('restartButton');

        // --- Game State Variables ---
        let gameMode = ''; 
        let difficulty = '';
        const humanPlayer = 'X';
        const aiPlayer = 'O';
        let currentPlayer = humanPlayer;
        let gameActive = true;
        let boardState = ['', '', '', '', '', '', '', '', ''];

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];
        
        // --- Menu Navigation ---
        function showDifficultyMenu() {
            mainMenu.classList.add('hidden');
            difficultyMenu.classList.remove('hidden');
        }

        function showMainMenu() {
            gameContainer.classList.add('hidden');
            difficultyMenu.classList.add('hidden');
            mainMenu.classList.remove('hidden');
        }

        function startGame(mode, level = null) {
            gameMode = mode;
            difficulty = level;
            difficultyMenu.classList.add('hidden');
            mainMenu.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            restartGame();
        }

        // --- Core Game Flow ---
        function handleCellClick(event) {
            const clickedCell = event.target;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-cell-index'));

            if (boardState[clickedCellIndex] !== '' || !gameActive || (gameMode === 'computer' && currentPlayer === aiPlayer)) {
                return;
            }
            
            makeMove(clickedCell, clickedCellIndex);
            
            if (checkEndGame()) return;
            
            if (gameMode === 'computer') {
                document.getElementById('gameBoard').style.pointerEvents = 'none';
                setTimeout(() => {
                    computerMove();
                    document.getElementById('gameBoard').style.pointerEvents = 'auto';
                }, 500);
            }
        }
        
        function makeMove(cell, index) {
            if (gameActive && boardState[index] === '') {
                boardState[index] = currentPlayer;
                cell.innerHTML = currentPlayer;
                cell.classList.add(currentPlayer);
                currentPlayer = (currentPlayer === humanPlayer) ? aiPlayer : humanPlayer;
                gameStatus.innerHTML = `It's ${currentPlayer}'s turn`;
            }
        }

        // --- Winning and Drawing Logic ---
        function checkEndGame() {
            let winner = checkWinner(boardState, humanPlayer) ? humanPlayer : checkWinner(boardState, aiPlayer) ? aiPlayer : null;

            if (winner) {
                gameStatus.innerHTML = `Player ${winner} has won!`;
                gameActive = false;
                return true;
            }
            if (!boardState.includes('')) {
                gameStatus.innerHTML = `Game ended in a draw!`;
                gameActive = false;
                return true;
            }
            return false;
        }
        
        function checkWinner(board, player) {
            for (const condition of winningConditions) {
                if (condition.every(index => board[index] === player)) {
                    return true;
                }
            }
            return false;
        }

        // --- AI Logic (Dispatcher) ---
        function computerMove() {
            if (!gameActive) return;
            let move;
            if (difficulty === 'hard') {
                move = findBestMove(boardState);
            } else if (difficulty === 'medium') {
                move = findMediumMove(boardState);
            } else { // easy
                move = findRandomMove(boardState);
            }
            const cellElement = document.querySelector(`.cell[data-cell-index='${move}']`);
            makeMove(cellElement, move);
            checkEndGame();
        }

        // --- AI Difficulty Functions ---
        function findRandomMove(board) {
            const availableCells = board
                .map((cell, index) => (cell === '' ? index : null))
                .filter(index => index !== null);
            return availableCells[Math.floor(Math.random() * availableCells.length)];
        }

        function findMediumMove(board) {
            // 1. Check if AI can win
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    let tempBoard = [...board];
                    tempBoard[i] = aiPlayer;
                    if (checkWinner(tempBoard, aiPlayer)) return i;
                }
            }
            // 2. Check if player is about to win (and block)
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    let tempBoard = [...board];
                    tempBoard[i] = humanPlayer;
                    if (checkWinner(tempBoard, humanPlayer)) return i;
                }
            }
            // 3. Else, make a random move
            return findRandomMove(board);
        }

        function findBestMove(board) { // Hard (Minimax)
            let bestVal = -Infinity;
            let bestMove = -1;
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    board[i] = aiPlayer;
                    let moveVal = minimax(board, 0, false);
                    board[i] = '';
                    if (moveVal > bestVal) {
                        bestMove = i;
                        bestVal = moveVal;
                    }
                }
            }
            return bestMove;
        }

        function minimax(board, depth, isMaximizing) {
            if (checkWinner(board, aiPlayer)) return 10 - depth;
            if (checkWinner(board, humanPlayer)) return depth - 10;
            if (!board.includes('')) return 0;

            if (isMaximizing) {
                let best = -Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] === '') {
                        board[i] = aiPlayer;
                        best = Math.max(best, minimax(board, depth + 1, !isMaximizing));
                        board[i] = '';
                    }
                }
                return best;
            } else {
                let best = Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] === '') {
                        board[i] = humanPlayer;
                        best = Math.min(best, minimax(board, depth + 1, !isMaximizing));
                        board[i] = '';
                    }
                }
                return best;
            }
        }
        
        // --- Restart Logic ---
        function restartGame() {
            currentPlayer = humanPlayer;
            gameActive = true;
            boardState = ['', '', '', '', '', '', '', '', ''];
            gameStatus.innerHTML = `It's ${currentPlayer}'s turn`;
            cells.forEach(cell => {
                cell.innerHTML = '';
                cell.classList.remove('X', 'O');
            });
            document.getElementById('gameBoard').style.pointerEvents = 'auto';
        }

        // --- Event Listeners ---
        playFriendButton.addEventListener('click', () => startGame('friend'));
        playComputerButton.addEventListener('click', showDifficultyMenu);
        backToMainButton.addEventListener('click', showMainMenu);
        backToMenuButton.addEventListener('click', showMainMenu);

        difficultyButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                startGame('computer', e.target.dataset.difficulty);
            });
        });
        
        cells.forEach(cell => cell.addEventListener('click', handleCellClick));
        restartButton.addEventListener('click', restartGame);

    </script>
</body>
</html>